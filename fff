pipeline {
    agent any

    environment {
        NEXT_VERSION = nextVersion(writeVersion: false)
    }

    stages {
        stage('Update Version') {
            steps {
                echo "next version = ${NEXT_VERSION}"
                echo "Current workspace is ${env.WORKSPACE}"
                bat 'node version-updater.js %NEXT_VERSION%'

                withCredentials([gitUsernamePassword(credentialsId: 'github',
                 gitToolName: 'git-tool')]) {
                    bat '''

             git changelog: false, credentialsId: 'github', poll: false, url: 'https://github.com/alimob7ark/Test.git'
             git config --get user.email
             git config --global user.name "alialmubarak.ite@gmail.com"
             git add .
              git --version
             git commit -m "Update Version"
             git.exe push -f origin main

             '''
                 }
            }
        }
    }
}
